# Depends on: ca-certificates krb5 libssh2 openssl zlib libpsl libnghttp2 libidn2 


packager="sipo"
contributors=""
maintainer="sipo"


description="An URL retrieval utility and library"
url="https://curl.haxx.se"


name=curl
version=7.65.0
release=1


source=(https://curl.haxx.se/download/curl-$version.tar.gz
		0001-Revert-progress-CURL_DISABLE_PROGRESS_METER.patch)


prepare(){
  patch -d "$name-$version" -Np1 <0001-Revert-progress-CURL_DISABLE_PROGRESS_METER.patch
}

build() {
  cd "$name-$version"

  ./configure \
      --prefix=/usr \
      --mandir=/usr/share/man \
      --disable-ldap \
      --disable-ldaps \
      --disable-manual \
      --enable-ipv6 \
      --enable-versioned-symbols \
      --enable-threaded-resolver \
      --with-gssapi \
      --with-libssh2 \
      --with-random=/dev/urandom \
      --with-ca-bundle=/etc/ssl/certs/ca-certificates.crt

  make
}

package() {
  cd "$name-$version"
  make DESTDIR="$PKG" install
  make DESTDIR="$PKG" install -C scripts
  install -Dt "$PKG/usr/share/licenses/$name" -m644 COPYING
}
