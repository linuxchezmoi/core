# Depends on: systemd libusb avahi python gnutls xdg-utils


packager="sipo"
contributors=""
maintainer="sipo"


run=(xdg-utils)
PKGMK_GROUPS=(devel man)


description="Print spooler and associated utilities"
url="https://www.cups.org/"


name=cups
version=2.2.11
release=4


source=(https://github.com/apple/cups/releases/download/v$version/$name-$version-source.tar.gz
		99-printer.rules)


prepare() {
	cd $name-$version
	sed -i 's:444:644:' Makedefs.in
	sed -i '/MAN.EXT/s:.gz::' configure config-scripts/cups-manpages.m4	
	aclocal  -I config-scripts
	autoconf -I config-scripts
}

build() {
	cd $name-$version
    CC=gcc CXX=g++ \
	./configure --libdir=/usr/lib            \
	            --with-rcdir=/tmp/cupsinit   \
	            --with-system-groups=lpadmin \
	            --with-docdir=/usr/share/cups/doc-2.2.11
	make
}

package() {
	cd $name-$version
    make install
    rm -rf /tmp/cupsinit
    ln -svnf ../cups/doc-2.2.11 /usr/share/doc/cups-2.2.11
    mkdir -p $PKG/etc/pam.d

cat > $PKG/etc/pam.d/cups << "EOF"
# Begin /etc/pam.d/cups

auth    include system-auth
account include system-account
session include system-session

# End /etc/pam.d/cups
EOF

mkdir -p $PKG/etc/udev/rules.d
install -m644 ../99-printer.rules  $PKG/etc/udev/rules.d/99-printer.rules
}

